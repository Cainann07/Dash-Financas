<div class="div-principal">
    <aside class="sidebar">
        <div class="sidebar-content">
            <img class="logo-sidebar" src="assets/wmremove-transformed-removebg-preview - Editado.png" alt="">
            <ul>

                <li><a href="src/app/pages/pagina_inicial/pagina_inicial.component.html"><span
                            class="material-symbols-outlined">
                            home
                        </span>
                        Tela Inicial</a>
                </li>
                <li><a href=""><span class="material-symbols-outlined">settings</span>
                        Configura√ß√µes</a>
                </li>
                <li><a href=""><span class="material-symbols-outlined">
                            logout
                        </span>
                        Logout</a>
                </li>
            </ul>
        </div>
    </aside>
    <main>
        <div class="dashboard-container fade-in">

            <header class="header-section">
                <div class="header-content">
                    <h1>Ol√°, Mateus! üëã</h1>
                    <p>Resumo financeiro de hoje.</p>
                </div>
            </header>

            <p-dialog header="Nova Movimenta√ß√£o" [(visible)]="modalVisivel" [modal]="true" [draggable]="false"
                [resizable]="false" styleClass="modal-transacao">

                <div class="form-grid">

                    <div class="form-group full-width">
                        <p-selectButton [options]="tipos" [(ngModel)]="novaTransacao.tipo" optionLabel="label"
                            optionValue="value" styleClass="w-full"></p-selectButton>
                    </div>

                    <div class="form-group full-width">
                        <label for="desc">Descri√ß√£o</label>
                        <input pInputText id="desc" [(ngModel)]="novaTransacao.descricao"
                            placeholder="Ex: Compras do m√™s" class="input-full" />
                    </div>

                    <div class="form-group half-width">
                        <label>Categoria</label>
                        <p-select [options]="categorias" [(ngModel)]="novaTransacao.categoria" optionLabel="label"
                            optionValue="value" placeholder="Selecione" appendTo="body" [style]="{'width': '100%'}">
                        </p-select>
                    </div>

                    <div class="form-group half-width">
                        <label>Valor (R$)</label>
                        <p-inputNumber [(ngModel)]="novaTransacao.valor" mode="currency" currency="BRL" locale="pt-BR"
                            placeholder="0,00"></p-inputNumber>
                    </div>

                </div>

                <ng-template pTemplate="footer">
                    <button pButton label="Cancelar" class="btn-cancelar" (click)="modalVisivel = false"></button>
                    <button pButton label="Salvar" class="btn-salvar" (click)="salvarTransacao()"></button>
                </ng-template>

            </p-dialog>

            <section class="kpi-grid">

                <div class="card-kpi border-green">
                    <div class="kpi-header">
                        <span>Meu or√ßamento</span>
                        <div class="icon-box bg-green">
                            <i class="pi pi-arrow-up"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{ resumo.entrada | currency:'BRL' }}</div>
                </div>

                <div class="card-kpi border-red">
                    <div class="kpi-header">
                        <span>Minhas despesas</span>
                        <div class="icon-box bg-red">
                            <i class="pi pi-arrow-down"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{ resumo.saida | currency:'BRL' }}</div>
                </div>

                <div class="card-kpi border-blue">
                    <div class="kpi-header">
                        <span>Saldo Atual</span>
                        <div class="icon-box bg-blue">
                            <i class="pi pi-wallet"></i>
                        </div>
                    </div>
                    <div class="kpi-value text-blue">{{ resumo.saldo | currency:'BRL' }}</div>
                </div>

            </section>

            <main class="main-grid">

                <div class="content-column">

                    <div class="card-widget mb-4">
                        <div class="widget-header">
                            <h3>Meus Objetivos</h3>
                            <p-button icon="pi pi-plus" styleClass="btn-icon-round"
                                (click)="abrirCriarMeta()"></p-button>
                        </div>

                        <div class="lista-metas">
                            <div *ngFor="let meta of metas.slice(0, 2)" class="meta-card" [style.--cor-meta]="meta.cor"
                                (click)="abrirDetalhesMeta(meta)">

                                <div class="meta-info">
                                    <span class="meta-nome">{{ meta.nome }}</span>
                                    <span class="meta-percent">{{ meta.progresso }}%</span>
                                </div>

                                <div class="barra-trilho">
                                    <div class="barra-preenchimento" [style.width.%]="meta.progresso"></div>
                                </div>

                                <small class="meta-valores">
                                    {{ meta.atual | currency:'BRL' }} de {{ meta.alvo | currency:'BRL' }}
                                </small>
                            </div>
                        </div>

                        <div *ngIf="metas.length > 2" class="botao-ver-mais">
                            <button pButton [label]="'Ver todos (' + metas.length + ')'" class="btn-expandir"
                                (click)="exibirTodasMetas()">
                            </button>
                        </div>
                    </div>

                    <p-dialog [(visible)]="modalTodasMetasVisivel" [modal]="true" header="Todos os Objetivos"
                        [draggable]="false" styleClass="modal-lista" [resizable]="false">

                        <div class="container-scroll">
                            <div *ngFor="let meta of metas" class="meta-card" [style.--cor-meta]="meta.cor"
                                (click)="abrirDetalhesMeta(meta)">

                                <div class="meta-info">
                                    <span class="meta-nome">{{ meta.nome }}</span>
                                    <span class="meta-percent">{{ meta.progresso }}%</span>
                                </div>

                                <div class="barra-trilho">
                                    <div class="barra-preenchimento" [style.width.%]="meta.progresso"></div>
                                </div>

                                <small class="meta-valores">
                                    {{ meta.atual | currency:'BRL' }} de {{ meta.alvo | currency:'BRL' }}
                                </small>
                            </div>
                        </div>
                    </p-dialog>

                    <p-dialog [(visible)]="modalMetaVisivel" [modal]="true" [header]="metaSelecionada?.nome"
                        [draggable]="false" styleClass="modal-objetivo" [resizable]="false">

                        <div *ngIf="metaSelecionada" class="modal-conteudo" [style.--cor-tema]="metaSelecionada.cor">
                            <div class="hero-section">
                                <div class="icone-circulo">
                                    <i class="pi" [ngClass]="metaSelecionada.icone"></i>
                                </div>
                                <h2 class="valor-grande">{{ metaSelecionada.atual | currency:'BRL' }}</h2>
                                <p class="valor-meta">Meta: {{ metaSelecionada.alvo | currency:'BRL' }}</p>
                                <div class="barra-modal-container">
                                    <p-progressBar [value]="metaSelecionada.progresso"></p-progressBar>
                                </div>
                            </div>

                            <div class="area-deposito">
                                <label>Guardar dinheiro neste cofre</label>
                                <div class="input-group">
                                    <p-inputNumber [(ngModel)]="valorDeposito" mode="currency" currency="BRL"
                                        locale="pt-BR" placeholder="R$ 0,00"
                                        styleClass="input-expandido"></p-inputNumber>
                                    <button pButton icon="pi pi-check" class="btn-confirmar"
                                        (click)="depositarNoCofre()"></button>
                                </div>
                            </div>
                        </div>
                    </p-dialog>

                    <p-dialog [(visible)]="modalCriarMetaVisivel" [modal]="true" header="Novo Objetivo"
                        [draggable]="false" styleClass="modal-criacao" [resizable]="false">

                        <div class="form-container">

                            <div class="campo-form">
                                <label>Nome do Objetivo</label>
                                <input pInputText [(ngModel)]="novaMeta.nome" placeholder="Ex: Viagem, Carro, PC Gamer"
                                    class="input-padrao-texto" />
                            </div>

                            <div class="grid-valores">
                                <div class="campo-form">
                                    <label>Valor Alvo (Meta)</label>
                                    <p-inputNumber [(ngModel)]="novaMeta.alvo" mode="currency" currency="BRL"
                                        locale="pt-BR" placeholder="R$ 0,00" styleClass="input-full">
                                    </p-inputNumber>
                                </div>

                                <div class="campo-form">
                                    <label>J√° tem algo guardado?</label>
                                    <p-inputNumber [(ngModel)]="novaMeta.inicial" mode="currency" currency="BRL"
                                        locale="pt-BR" placeholder="R$ 0,00 (Opcional)" styleClass="input-full">
                                    </p-inputNumber>
                                </div>
                            </div>

                            <div class="form-group half-width">
                                <label>Categoria</label>
                                <p-select [options]="categorias" [(ngModel)]="novaTransacao.categoria"
                                    optionLabel="label" optionValue="value" placeholder="Selecione" appendTo="body"
                                    [style]="{'width': '100%'}">
                                </p-select>
                            </div>

                        </div>

                        <ng-template pTemplate="footer">
                            <button pButton label="Cancelar" class="btn-texto"
                                (click)="modalCriarMetaVisivel = false"></button>
                            <button pButton label="Criar Objetivo" class="btn-primario"
                                [disabled]="!novaMeta.nome || !novaMeta.alvo" (click)="salvarNovaMeta()">
                            </button>
                        </ng-template>

                    </p-dialog>

                    <div class="card-widget">
                        <div class="widget-header">
                            <h3>√öltimos Lan√ßamentos</h3>
                            <p-button label="Nova Transa√ß√£o" icon="pi pi-plus" styleClass="btn-primary"
                                (click)="abrirModal()"></p-button>
                        </div>

                        <p-table [value]="transacoes" styleClass="clean-table" [rows]="5">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Descri√ß√£o</th>
                                    <th>Categoria</th>
                                    <th>Data</th>
                                    <th class="text-right">Valor</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-t>
                                <tr>
                                    <td class="font-bold">{{ t.nome }}</td>
                                    <td><span class="badge">{{ t.categoria }}</span></td>
                                    <td class="text-gray">{{ t.data }}</td>
                                    <td class="text-right font-bold"
                                        [ngClass]="t.tipo === 'despesa' ? 'text-red' : 'text-green'">
                                        {{ t.tipo === 'despesa' ? '-' : '+' }} {{ t.valor | currency:'BRL' }}
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>

                        <div class="rodape-widget">
                            <a class="link-acao" (click)="abrirExtratoCompleto()">
                                Ver extrato completo
                            </a>
                        </div>

                        <p-dialog [(visible)]="modalExtratoVisivel" [modal]="true" header="Extrato Completo"
                            [draggable]="false" styleClass="modal-extrato" [resizable]="false">

                            <p-table [value]="transacoes" [paginator]="true" [rows]="7" styleClass="tabela-limpa"
                                responsiveLayout="scroll">

                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Descri√ß√£o</th>
                                        <th>Categoria</th>
                                        <th>Data</th>
                                        <th class="coluna-valor">Valor</th>
                                    </tr>
                                </ng-template>

                                <ng-template pTemplate="body" let-t>
                                    <tr>
                                        <td>
                                            <span class="texto-principal">{{ t.nome }}</span>
                                            <small class="texto-secundario">{{ t.tipo }}</small>
                                        </td>
                                        <td>
                                            <span class="badge-categoria">{{ t.categoria }}</span>
                                        </td>
                                        <td class="texto-data">{{ t.data }}</td>

                                        <td class="coluna-valor"
                                            [ngClass]="t.tipo === 'despesa' ? 'valor-negativo' : 'valor-positivo'">
                                            {{ t.tipo === 'despesa' ? '-' : '+' }} {{ t.valor | currency:'BRL' }}
                                        </td>
                                    </tr>
                                </ng-template>

                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="4" class="mensagem-vazia">
                                            Nenhuma movimenta√ß√£o encontrada.
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>

                        </p-dialog>
                    </div>
                </div>

                <aside class="sidebar-column">

                    <div class="card-widget">
                        <h3 class="sidebar-title">Contas a Pagar</h3>
                        <ul class="bill-list">
                            <li *ngFor="let conta of contasFuturas" class="bill-item">
                                <div class="bill-date">
                                    <small>VENC.</small>
                                    <strong>{{ conta.data.split('/')[0] }}</strong>
                                </div>
                                <div class="bill-info">
                                    <span class="bill-name">{{ conta.descricao }}</span>
                                    <span *ngIf="conta.status === 'urgente'" class="status-alert">Vence Hoje!</span>
                                </div>
                                <div class="bill-action">
                                    <span>{{ conta.valor | currency:'BRL' }}</span>
                                    <!-- <button pButton icon="pi pi-check" class="btn-check"></button> -->
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div class="card-widget">
                        <h3 class="sidebar-title">Top Gastos</h3>
                        <div *ngFor="let item of topGastos" class="spending-item">
                            <div class="spending-icon {{ item.bgIcone }} {{ item.corIcone }}">
                                <i class="pi {{ item.icone }}"></i>
                            </div>
                            <span class="spending-name">{{ item.categoria }}</span>
                            <span class="spending-value">{{ item.valor | currency:'BRL' }}</span>
                        </div>
                    </div>
                </aside>

            </main>
        </div>

    </main>

</div>